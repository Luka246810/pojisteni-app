<!DOCTYPE html>
<html lang="cs" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
</head>
<body>
<th:block th:replace="~{layout :: main(~{::section})}">
    <section>

        <div class="d-flex align-items-center justify-content-between mb-4">
            <h1 class="mb-0">Přehled</h1>
        </div>

        <!-- Info hlášky -->
        <div class="alert alert-light border mb-4">
            Vítej v <strong>PojištěníApp</strong>. Vyber si, co chceš dělat:
        </div>
        <div class="alert alert-warning py-2" th:if="${param.denied}">
            Nemáš oprávnění pro požadovanou akci. Přihlas se jiným účtem nebo kontaktuj administrátora.
        </div>

        <!-- Anonymní uživatel -->
        <div sec:authorize="isAnonymous()" class="mb-4">
            <h3 class="h5 mb-3">Abyste mohli něco vidět a dělat, musíte se přihlásit</h3>
            <a class="btn btn-primary me-2" th:href="@{/login}">Přihlásit</a>
            <a class="btn btn-outline-secondary" th:href="@{/register}">Registrovat</a>
        </div>

        <div class="row g-4">

            <!-- KARTA POJIŠTĚNCI -->
            <div class="col-md-6" sec:authorize="isAuthenticated()">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-between">
                            <h5 class="card-title mb-0">Pojištěnci</h5>
                            <span class="badge text-bg-secondary" th:text="${countPojistenci!=null? countPojistenci : 0}">0</span>
                        </div>

                        <!-- Text pro USER -->
                        <p class="card-text text-muted mt-2 mb-4" sec:authorize="hasRole('USER')">
                            Prohlížej a upravuj si svůj profil.
                        </p>
                        <!-- Text pro ADMIN -->
                        <p class="card-text text-muted mt-2 mb-4" sec:authorize="hasRole('ADMIN')">
                            Přidávej a upravuj pojištěnce.
                        </p>

                        <!-- Akce USER -->
                        <div class="mt-auto" sec:authorize="hasRole('USER')">
                            <!-- tlačítko jen pokud máme pojistenyId -->
                            <a class="btn btn-warning"
                               th:if="${#authentication?.principal?.pojistenyId != null}"
                               th:href="@{/ucet}">Můj profil</a>

                            <!-- fallback info když pojistenyId ještě není -->
                            <div class="text-muted small" th:if="${#authentication?.principal?.pojistenyId == null}">
                                Zatím nemáš vyplněný profil. Otevři <a th:href="@{/ucet}">Můj profil</a> a ulož své údaje.
                            </div>
                        </div>

                        <!-- Akce ADMIN -->
                        <div class="mt-auto" sec:authorize="hasRole('ADMIN')">
                            <a class="btn btn-primary" th:href="@{/pojistenci}">Seznam pojištěnců</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KARTA POJIŠTĚNÍ -->
            <div class="col-md-6" sec:authorize="isAuthenticated()">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-between">
                            <h5 class="card-title mb-0" sec:authorize="hasRole('ADMIN')">Pojištění</h5>
                            <h5 class="card-title mb-0" sec:authorize="hasRole('USER')">Pojištění / Události</h5>
                            <span class="badge text-bg-secondary" th:text="${countPojistky!=null? countPojistky : 0}">0</span>
                        </div>

                        <p class="card-text text-muted mt-2 mb-4" sec:authorize="hasRole('USER')">
                            Prohlížej si tvoje sjednaná pojištění a tvoje události.
                        </p>
                        <p class="card-text text-muted mt-2 mb-4" sec:authorize="hasRole('ADMIN')">
                            Přidávej a upravuj pojištění.
                        </p>

                        <div class="mt-auto">
                            <!-- USER: moje pojištění – jen pokud známe pojistenyId -->
                            <a class="btn btn-warning me-2" sec:authorize="hasRole('USER')"
                               th:if="${#authentication?.principal?.pojistenyId != null}"
                               th:href="@{/pojistenci/detail/{id}(id=${#authentication.principal.pojistenyId})}">
                                Moje pojištění / události
                            </a>
                            <!-- ADMIN: seznam všech -->
                            <a class="btn btn-primary" sec:authorize="hasRole('ADMIN')"
                               th:href="@{/pojistky}">
                                Seznam pojistek
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UDÁLOSTI (ADMIN) -->
            <div class="col-md-6" sec:authorize="hasRole('ADMIN')">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-between">
                            <h5 class="card-title mb-0">Události</h5>
                        </div>
                        <p class="card-text text-muted mt-2 mb-4">
                            Přidávej a upravuj události.
                        </p>
                        <div class="mt-auto">
                            <a class="btn btn-primary" th:href="@{/udalosti}">Seznam událostí</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REPORTY (ADMIN) -->
            <div class="col-md-6" sec:authorize="hasRole('ADMIN')">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-between">
                            <h5 class="card-title mb-0">Reporty</h5>
                        </div>
                        <p class="card-text text-muted mt-2 mb-4">
                            Podívej se, jak si vedeme.
                        </p>
                        <div class="mt-auto">
                            <a class="btn btn-primary" th:href="@{/reporty}">Seznam reportů</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </section>
</th:block>
</body>
</html>
