<!doctype html>
<html lang="cs" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout :: main(~{::section})}">
    <section>
        <h1 th:text="${u.id} == null ? 'Nová pojistná událost' : 'Upravit událost'">Událost</h1>

        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-semibold">Pojistná událost</div>
            <div class="card-body">
                <form th:action="@{/udalosti/save}" th:object="${u}" method="post" class="row g-3 needs-validation" novalidate>
                    <input type="hidden" th:field="*{id}">
                    <input type="hidden" th:field="*{pojistenyId}">

                    <div class="col-md-4">
                        <label class="form-label">Datum</label>
                        <input class="form-control" type="date"
                               th:value="${#temporals.format(u.datum, 'yyyy-MM-dd')}"
                               name="datum" required/>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Škoda (Kč)</label>
                        <input class="form-control" type="number" step="0.01" min="0" th:field="*{skoda}" required>
                        <div class="invalid-feedback">Zadejte částku škody.</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Stav</label>
                        <select class="form-select" th:field="*{stav}">
                            <option th:value="NOVA">Nová</option>
                            <option th:value="RESENA">Řešená</option>
                            <option th:value="UZAVRENA">Uzavřená</option>
                        </select>
                    </div>

                    <div class="col-12">
                        <label class="form-label">Popis</label>
                        <textarea class="form-control" rows="4" th:field="*{popis}" placeholder="Co se stalo?" required></textarea>
                        <div class="invalid-feedback">Popis je povinný.</div>
                    </div>

                    <div class="col-12 d-flex gap-2">
                        <button class="btn btn-primary" type="submit" th:text="${u.id} == null ? 'Uložit' : 'Uložit změny'">Uložit</button>
                        <a class="btn btn-outline-secondary"
                           th:href="${u.pojistenyId} != null ? @{/pojistenci/detail/{id}(id=${u.pojistenyId})} : @{/udalosti}">
                            Zpět
                        </a>
                    </div>

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                </form>
            </div>
        </div>

        <script>
            (function(){
              const f=document.querySelector('.needs-validation');
              if(!f) return;
              f.addEventListener('submit',e=>{
                if(!f.checkValidity()){e.preventDefault();e.stopPropagation();}
                f.classList.add('was-validated');
              });
            })();
        </script>
    </section>
</th:block>
</html>
