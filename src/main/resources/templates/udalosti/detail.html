<!doctype html>
<html lang="cs" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<th:block th:replace="~{layout :: main(~{::section})}">
    <section>
        <h1>Detail pojistné události</h1>

        <dl class="row">
            <dt class="col-sm-3">Datum</dt>
            <dd class="col-sm-9" th:text="${#temporals.format(u.datum,'d.M.yyyy')}">—</dd>

            <dt class="col-sm-3">Škoda</dt>
            <dd class="col-sm-9" th:text="${#numbers.formatDecimal(u.skoda,1,'WHITESPACE',2,'POINT')} + ' Kč'">0 Kč</dd>

            <dt class="col-sm-3">Stav</dt>
            <dd class="col-sm-9">
                <span class="badge"
                      th:classappend="${u.stav}=='NOVA' ? ' text-bg-warning' :
                                      (${u.stav}=='RESENA' ? ' text-bg-info' : ' text-bg-success')"
                      th:text="${u.stav}">NOVA</span>
            </dd>

            <dt class="col-sm-3">Popis</dt>
            <dd class="col-sm-9" th:text="${u.popis}">—</dd>
        </dl>

        <div class="mt-3">
            <!-- Pokud chceš jemnější pravidla (např. @sec.canEditUdalost), použij th:if s beany:
                 <a ... th:if="${@sec.canEditUdalost(#authentication, u.id)}">Editovat</a>
            -->
            <a class="btn btn-warning" th:href="@{/udalosti/edit/{id}(id=${u.id})}"
               sec:authorize="hasRole('ADMIN')">Editovat</a>

            <form class="d-inline" th:action="@{/udalosti/delete/{id}(id=${u.id})}" method="post" sec:authorize="hasRole('ADMIN')">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-danger" onclick="return confirm('Smazat událost?')">Odstranit</button>
            </form>

            <!-- Zpět -->
            <a class="btn btn-secondary"
               th:href="${u.pojistenyId} != null ? @{/pojistenci/detail/{id}(id=${u.pojistenyId})} : @{/udalosti}"
               onclick="if (history.length > 1) { history.back(); } else { window.location = this.getAttribute('href'); } return false;">
                Zpět
            </a>
        </div>
    </section>
</th:block>
</html>
