<!DOCTYPE html>
<html lang="cs" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pojištění</title>
</head>
<body>
<th:block th:replace="~{layout :: main(~{::section})}">
    <section>

        <!-- Nadpis + vyhledávání v jedné řadě -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0">Pojištění</h1>

            <form class="d-flex gap-2" method="get" th:action="@{/pojistky}">
                <!-- Placeholder odpovídá tomu, co už vyhledáváš v repo (ID/název/částka) -->
                <input class="form-control" name="q" th:value="${q}" placeholder="ID pojistky, Název, Částka">
                <button class="btn btn-primary" type="submit">Hledat</button>
                <a class="btn btn-outline-secondary" th:href="@{/pojistky}">Zrušit</a>
            </form>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                <tr>
                    <th class="text-nowrap">ID pojistky</th>
                    <th>Název</th>
                    <th>Částka</th>
                    <th>Platnost od</th>
                    <th>Platnost do</th>
                    <th>Pojištěný (ID)</th>
                    <th style="width:220px">Akce</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="t : ${pojistky}">
                    <!-- ID pojistky -->
                    <td class="text-center">
                        <a th:href="@{/pojistky/detail/{id}(id=${t.id})}" th:text="${t.id}">1</a>
                    </td>

                    <!-- Název pojistky -->
                    <td th:text="${t.nazev}">Název</td>

                    <!-- Částka (bezpečný fallback) -->
                    <td>
                        <span th:text="${t.castka != null
                                        ? #numbers.formatDecimal(t.castka,0,'COMMA',2,'POINT')
                                        : '0'}">0</span>&nbsp;Kč
                    </td>

                    <!-- Platnost od -->
                    <td>
                        <span th:if="${t.platnostOd != null}"
                              th:text="${#temporals.format(t.platnostOd, 'dd.MM.yyyy')}">01.01.2025</span>
                        <span th:if="${t.platnostOd == null}">-</span>
                    </td>

                    <!-- Platnost do -->
                    <td>
                        <span th:if="${t.platnostDo != null}"
                              th:text="${#temporals.format(t.platnostDo, 'dd.MM.yyyy')}">31.12.2025</span>
                        <span th:if="${t.platnostDo == null}">-</span>
                    </td>

                    <!-- Pojištěný (ID): klikací, pokud existuje vazba -->
                    <td>
                        <a th:if="${t.pojisteny != null}"
                           th:href="@{/pojistenci/detail/{id}(id=${t.pojisteny.id})}"
                           th:text="${t.pojisteny.id}">7</a>
                        <span th:if="${t.pojisteny == null}">-</span>
                    </td>

                    <!-- Akce -->
                    <td class="text-end">
                        <div class="d-inline-flex gap-2">
                            <form th:action="@{/pojistky/delete/{id}(id=${t.id})}" method="post"
                                  onsubmit="return confirm('Opravdu smazat tuto pojistku?')">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-danger btn-sm" type="submit">Odstranit</button>
                            </form>
                            <a th:href="@{/pojistky/edit/{id}(id=${t.id})}"
                               class="btn btn-warning btn-sm">Editovat</a>
                        </div>
                    </td>
                </tr>

                <!-- Pokud nejsou žádné pojistky -->
                <tr th:if="${pojistky == null or #lists.isEmpty(pojistky)}">
                    <td colspan="7" class="text-center text-muted">Žádná pojištění nenalezena.</td>
                </tr>
                </tbody>
            </table>
        </div>

    </section>
</th:block>
</body>
</html>
